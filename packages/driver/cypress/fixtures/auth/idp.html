<!DOCTYPE html>
<html>
<head>
</head>
<body>
    <label for="name">Username: </label>
    <input data-cy="username" type="text" name="name" id="name" required>
    <button data-cy="login">Login</button>

  <script>
    document.querySelector('[data-cy="login"]').addEventListener('click', () => {

      const expiry = new Date()
      // Expire in 10 minutes
      expiry.setMinutes(expiry.getMinutes() + 10)
      // create faux jwt
      const fauxJwt = {
        header: {
          alg: 'string',
          type: 'JWT'
        },
        body: {
          username: document.querySelector('[data-cy="username"]').value,
          expiry: expiry.toISOString()
        }
      }
      // redirect
      const queryString = window.location.search;
      const urlParams = new URLSearchParams(queryString);
      let redirect = urlParams.get('redirect')

      if (redirect){
        redirect = decodeURIComponent(redirect)
      } else {
        redirect = 'http://localhost:3500/fixtures/auth/index.html'
      }

      const redirectUrl = new URL(redirect)
      const redirectUrlParams = new URLSearchParams(redirectUrl.search);
      redirectUrlParams.append('token', encodeURIComponent(JSON.stringify(fauxJwt)))
      redirectUrl.search = redirectUrlParams.toString()
      window.location.href = redirectUrl.href
    })
  </script>
</body>
</html>
